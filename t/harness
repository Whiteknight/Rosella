INIT {
    pir::load_bytecode("rosella/core.pbc");
    pir::load_bytecode("rosella/harness.pbc");
}

my $factory := Rosella::construct(Rosella::Harness::TestRun::Factory);
$factory.add_test_dirs("NQP",
    "t/core"
);
my $corerun := $factory.create();

$factory.add_test_dirs("NQP",
    "t/tap_harness",    # "harness", can't shadow t/harness program
    "t/test",
    "t/action",
    "t/container",
    "t/event",
    "t/prototype",
    "t/query",
    "t/path",
    "t/proxy",
    "t/mockobject",
    "t/memoize",
    :recurse(1)
);
my $librun := $factory.create();

my $harness := Rosella::construct(Rosella::Harness);
my $testview := $harness.default_view();
$testview.add_run($corerun, 0);
$testview.add_run($librun, 0);


my $result := $harness.run($corerun, $testview);
if ($result) {
    $harness.run($librun, $testview);
}
$testview.show_results();


