namespace Rosella { namespace Template { namespace Node
{
    class Eval : Rosella.Template.Node
    {
        var func;

        function Eval(var token)
        {
            self.Node(token);
            self.func = null;
        }

        function render(var context, var builder)
        {
            string code = self.token.data();
            string code_s = sprintf("function EVAL_%d[anon](var context) { string result = ''; %s; return result; }", [self.eval_count, code]);
            var winxed = compreg("winxed");
            var func = winxed.compile(code_s);
            var result = func(context);
            return result;
        }
    }
}}}
